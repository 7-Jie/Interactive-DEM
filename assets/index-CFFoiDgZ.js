var wt=Object.defineProperty;var At=(a,e,t)=>e in a?wt(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var y=(a,e,t)=>At(a,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const Rt=`#version 300 es
layout(location=0) in vec2 aUnit; // unit circle verts
layout(location=1) in vec2 iPos; // per-instance position
layout(location=2) in vec2 iAB; // per-instance semi-axes (a,b)
layout(location=3) in vec2 iRot; // (cosθ, sinθ)
uniform vec2 uRes; // canvas size in px
uniform float uScale; // px→N world scale


void main(){
vec2 p = aUnit * iAB; // scale unit circle into ellipse
// rotate by θ
vec2 r = vec2(
p.x * iRot.x - p.y * iRot.y,
p.x * iRot.y + p.y * iRot.x
);
vec2 world = iPos + r; // translate
// NDC
vec2 ndc = (world / uRes)*2.0 - 1.0; // positions already in pixels
ndc.y = -ndc.y; // flip Y for WebGL
gl_Position = vec4(ndc, 0.0, 1.0);
}
`,Mt=`#version 300 es
precision mediump float;
out vec4 o;
uniform vec4 uFill;
uniform vec4 uStroke;
void main(){
// Simple solid fill; stroke drawn by second pass if wanted
o = uFill;
}
`;class bt{constructor(e){y(this,"gl");y(this,"prog");y(this,"vao");y(this,"uRes");y(this,"uFill");y(this,"uStroke");y(this,"uScale");y(this,"vbuf");y(this,"ibuf");y(this,"bPos");y(this,"bAB");y(this,"bRot");y(this,"verts");y(this,"segs");const t=e.getContext("webgl2");if(!t)throw new Error("WebGL2 required");this.gl=t,this.vao=null,this.prog=this.mkProg(Rt,Mt),this.uRes=t.getUniformLocation(this.prog,"uRes"),this.uFill=t.getUniformLocation(this.prog,"uFill"),this.uStroke=t.getUniformLocation(this.prog,"uStroke"),this.uScale=t.getUniformLocation(this.prog,"uScale");const n=500;this.segs=n;const i=[0,0];for(let l=0;l<=n;l++){const c=2*Math.PI*l/n;i.push(Math.cos(c),Math.sin(c))}const o=[];for(let l=1;l<n;l++)o.push(0,l,l+1);this.verts=o.length,this.vao=t.createVertexArray(),t.bindVertexArray(this.vao),this.vbuf=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vbuf),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0),this.ibuf=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.ibuf),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(o),t.STATIC_DRAW),this.bPos=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.bPos),t.enableVertexAttribArray(1),t.vertexAttribPointer(1,2,t.FLOAT,!1,0,0),t.vertexAttribDivisor(1,1),this.bAB=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.bAB),t.enableVertexAttribArray(2),t.vertexAttribPointer(2,2,t.FLOAT,!1,0,0),t.vertexAttribDivisor(2,1),this.bRot=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.bRot),t.enableVertexAttribArray(3),t.vertexAttribPointer(3,2,t.FLOAT,!1,0,0),t.vertexAttribDivisor(3,1),t.bindVertexArray(null)}mkProg(e,t){const n=this.gl,i=n.createShader(n.VERTEX_SHADER);if(n.shaderSource(i,e),n.compileShader(i),!n.getShaderParameter(i,n.COMPILE_STATUS))throw new Error(n.getShaderInfoLog(i)??"vs compile error");const o=n.createShader(n.FRAGMENT_SHADER);if(n.shaderSource(o,t),n.compileShader(o),!n.getShaderParameter(o,n.COMPILE_STATUS))throw new Error(n.getShaderInfoLog(o)??"fs compile error");const l=n.createProgram();if(n.attachShader(l,i),n.attachShader(l,o),n.linkProgram(l),!n.getProgramParameter(l,n.LINK_STATUS))throw new Error(n.getProgramInfoLog(l)??"link error");return n.deleteShader(i),n.deleteShader(o),l}draw(e,t,n,i,o,l,c,h,f){const s=this.gl,x=window.devicePixelRatio||1;(s.canvas.width!==Math.floor(e*x)||s.canvas.height!==Math.floor(t*x))&&(s.canvas.width=Math.floor(e*x),s.canvas.height=Math.floor(t*x)),s.viewport(0,0,s.canvas.width,s.canvas.height),s.clearColor(.05,.07,.09,1),s.clear(s.COLOR_BUFFER_BIT),s.useProgram(this.prog),s.uniform2f(this.uRes,s.canvas.width,s.canvas.height);function R(m,S=1){const r=parseInt(m.slice(1,3),16)/255,w=parseInt(m.slice(3,5),16)/255,L=parseInt(m.slice(5,7),16)/255;return[r,w,L,S]}const b=f?.filled??!0,g=R(f?.fill??"#6aa84f"),A=R(f?.stroke??"#2e7d32"),D=f?.strokeW??1;s.uniform4f(this.uFill,g[0],g[1],g[2],g[3]),s.uniform4f(this.uStroke,A[0],A[1],A[2],A[3]),s.bindVertexArray(this.vao);const B=new Float32Array(h*2),T=new Float32Array(h*2),_=new Float32Array(h*2);for(let m=0;m<h;m++)B[2*m]=n[m],B[2*m+1]=i[m],T[2*m]=o[m],T[2*m+1]=l[m],_[2*m]=Math.cos(c[m]),_[2*m+1]=Math.sin(c[m]);if(s.bindBuffer(s.ARRAY_BUFFER,this.bPos),s.bufferData(s.ARRAY_BUFFER,B,s.DYNAMIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,this.bAB),s.bufferData(s.ARRAY_BUFFER,T,s.DYNAMIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,this.bRot),s.bufferData(s.ARRAY_BUFFER,_,s.DYNAMIC_DRAW),D>0){const m=new Float32Array(h*2);for(let S=0;S<h;S++)m[2*S]=T[2*S]+D,m[2*S+1]=T[2*S+1]+D;s.uniform4f(this.uFill,A[0],A[1],A[2],A[3]),s.bindBuffer(s.ARRAY_BUFFER,this.bAB),s.bufferData(s.ARRAY_BUFFER,m,s.DYNAMIC_DRAW),s.drawElementsInstanced(s.TRIANGLES,this.verts,s.UNSIGNED_SHORT,0,h),s.bindBuffer(s.ARRAY_BUFFER,this.bAB),s.bufferData(s.ARRAY_BUFFER,T,s.DYNAMIC_DRAW)}b&&(s.uniform4f(this.uFill,g[0],g[1],g[2],g[3]),s.drawElementsInstanced(s.TRIANGLES,this.verts,s.UNSIGNED_SHORT,0,h)),s.bindVertexArray(null)}}function pt(a,e,t,n){const i=Math.ceil(a/t),o=Math.ceil(e/t);return{w:a,h:e,cell:t,cols:i,rows:o,head:new Int32Array(i*o).fill(-1),next:new Int32Array(n).fill(-1)}}function Ft(a,e,t,n){a.head.fill(-1),a.next.fill(-1);const{cols:i,rows:o,cell:l}=a;for(let c=0;c<n;c++){const h=Math.max(0,Math.min(i-1,e[c]/l|0)),s=Math.max(0,Math.min(o-1,t[c]/l|0))*i+h;a.next[c]=a.head[s],a.head[s]=c}}function Pt(a,e,t,n){const{cols:i,rows:o,head:l,next:c}=a;for(let h=0;h<o;h++)for(let f=0;f<i;f++)for(let s=-1;s<=1;s++)for(let x=-1;x<=1;x++){const R=f+x,b=h+s;if(R<0||b<0||R>=i||b>=o)continue;let g=l[h*i+f];for(;g!==-1;){let A=l[b*i+R];for(;A!==-1;)g<A&&n(g,A),A=c[A];g=c[g]}}}class St{constructor(e,t,n,i){y(this,"wx0");y(this,"wy0");y(this,"wx1");y(this,"wy1");y(this,"nWalls",0);y(this,"x");y(this,"y");y(this,"vx");y(this,"vy");y(this,"ax");y(this,"ay");y(this,"a");y(this,"b");y(this,"th");y(this,"w");y(this,"I");y(this,"m");y(this,"fx");y(this,"fy");y(this,"T");y(this,"n",0);y(this,"maxN");y(this,"grid");y(this,"p");y(this,"width",0);y(this,"height",0);this.maxN=e,this.width=t,this.height=n,this.p=i;const o=l=>new Float32Array(l);this.x=o(e),this.y=o(e),this.vx=o(e),this.vy=o(e),this.ax=o(e),this.ay=o(e),this.a=o(e),this.b=o(e),this.th=o(e),this.w=o(e),this.I=o(e),this.m=o(e),this.fx=o(e),this.fy=o(e),this.T=o(e),this.grid=pt(t,n,i.cell,e),this.wx0=new Float32Array(1024),this.wy0=new Float32Array(1024),this.wx1=new Float32Array(1024),this.wy1=new Float32Array(1024),this.nWalls=0}resize(e,t){this.width=e,this.height=t,this.grid=pt(e,t,this.p.cell,this.maxN)}add(e,t,n,i){if(this.n>=this.maxN)return;const o=this.n++;this.x[o]=e,this.y[o]=t,this.vx[o]=0,this.vy[o]=0,this.ax[o]=0,this.ay[o]=0,this.a[o]=n,this.b[o]=i,this.th[o]=Math.random()*Math.PI*2,this.w[o]=0;const l=1,c=Math.PI*n*i;this.m[o]=l*c,this.I[o]=.25*c*(n*n+i*i)}addWall(e,t,n,i){if(this.nWalls>=1024)return;const o=this.nWalls++;this.wx0[o]=e,this.wy0[o]=t,this.wx1[o]=n,this.wy1[o]=i}clearWalls(){this.nWalls=0}removeWallAt(e){if(e<0||e>=this.nWalls)return;const t=this.nWalls-1;this.wx0[e]=this.wx0[t],this.wy0[e]=this.wy0[t],this.wx1[e]=this.wx1[t],this.wy1[e]=this.wy1[t],this.nWalls--}dampingC(e,t){const n=Math.max(1e-4,this.p.e);return 2*(1/Math.sqrt(1+(Math.PI/Math.log(n))**2))*Math.sqrt(t*e)}supportRadius(e,t,n,i,o){const l=Math.cos(n),c=Math.sin(n),h=l*i+c*o,f=-c*i+l*o,s=Math.max(1e-6,e*h*(e*h)+t*f*(t*f));return Math.sqrt(s)}closestPointOnSegment(e,t,n,i,o,l){const c=o-n,h=l-i,f=c*c+h*h;let s=0;return f>0&&(s=((e-n)*c+(t-i)*h)/f,s=Math.min(1,Math.max(0,s))),{x:n+s*c,y:i+s*h}}step(){const{n:e,x:t,y:n,vx:i,vy:o,ax:l,ay:c,a:h,b:f,th:s,w:x,fx:R,fy:b,T:g,m:A,I:D}=this,{dt:B,substeps:T,kn:_,mu:m}=this.p;for(let S=0;S<T;S++){R.fill(0,0,e),b.fill(0,0,e),g.fill(0,0,e);for(let r=0;r<e;r++)R[r]+=this.p.gx*A[r],b[r]+=this.p.gy*A[r];Ft(this.grid,t,n,e),Pt(this.grid,t,n,(r,w)=>{const L=t[w]-t[r],G=n[w]-n[r],P=L*L+G*G;if(P<=1e-12)return;const U=Math.sqrt(P),E=L/U,M=G/U,Y=this.supportRadius(h[r],f[r],s[r],E,M),N=this.supportRadius(h[w],f[w],s[w],-E,-M),$=Y+N-U;if($>0){const C=A[r],O=A[w],X=C*O/(C+O),j=i[r]+-x[r]*M*Y,tt=o[r]+x[r]*E*Y,et=i[w]+-x[w]*M*N,nt=o[w]+x[w]*E*N,K=et-j,J=nt-tt,it=K*E+J*M,Q=_*$,Z=this.dampingC(X,_),ot=it<0?-Z*it:0,st=Q+ot,ht=-M,q=E,rt=K*ht+J*q;let H=-(.4*Z)*rt;const ft=m*Q;H=Math.max(-ft,Math.min(ft,H));const ut=st*E+H*ht,yt=st*M+H*q;R[r]-=ut,b[r]-=yt,R[w]+=ut,b[w]+=yt,g[r]-=Y*H,g[w]+=N*H}});for(let r=0;r<e;r++)for(let w=0;w<this.nWalls;w++){const L=this.wx0[w],G=this.wy0[w],P=this.wx1[w],U=this.wy1[w],E=this.closestPointOnSegment(t[r],n[r],L,G,P,U),M=t[r]-E.x,Y=n[r]-E.y,N=M*M+Y*Y;if(N<=1e-12)continue;const $=Math.sqrt(N);let C=M/$,O=Y/$;const X=this.supportRadius(h[r],f[r],s[r],C,O),j=X-$;if(j>0){const tt=i[r]+-x[r]*O*X,et=o[r]+x[r]*C*X,nt=tt*C+et*O,K=_*j,J=this.dampingC(A[r],_),it=nt<0?-J*nt:0,Q=K+it,Z=-O,ot=C,st=tt*Z+et*ot;let q=-(.4*J)*st;const rt=this.p.muw*K;q=Math.max(-rt,Math.min(rt,q));const dt=Q*C+q*Z,H=Q*O+q*ot;R[r]+=dt,b[r]+=H,g[r]+=X*q}}for(let r=0;r<e;r++){const w=R[r]/A[r],L=b[r]/A[r],G=this.p.damp,P=this.p.dt,U=1/(1+G*P);i[r]=(i[r]+(l[r]+w)*.5*P)*U,o[r]=(o[r]+(c[r]+L)*.5*P)*U,l[r]=w,c[r]=L,t[r]+=i[r]*P+.5*l[r]*P*P,n[r]+=o[r]*P+.5*c[r]*P*P;const E=g[r]/Math.max(1e-6,D[r]);x[r]=(x[r]+E*P)*U,s[r]+=x[r]*P+.5*E*P*P;const M=Math.max(h[r],f[r]);n[r]-M<0&&(n[r]=M,o[r]*=-.2),n[r]+M>this.height&&(n[r]=this.height-M,o[r]*=-.2),t[r]-M<0&&(t[r]=M,i[r]*=-.2),t[r]+M>this.width&&(t[r]=this.width-M,i[r]*=-.2)}}}}function Et(a,e,t){a.innerHTML="";const n=(l,c,h,f,s)=>{const x=document.createElement("label");x.innerHTML=`${l}<input type="range" min="${c}" max="${h}" step="${f}"> <span class="val"></span>`;const R=x.querySelector("input"),b=x.querySelector(".val");function g(){R.value=String(e[s]),b.textContent=e[s].toFixed(2)}R.oninput=()=>{e[s]=parseFloat(R.value),g(),t()},g(),a.appendChild(x)},i=(l,c)=>{const h=document.createElement("label");h.innerHTML=`${l}<input type="checkbox">`;const f=h.querySelector("input");f.checked=!!e[c],f.oninput=()=>{e[c]=f.checked,t()},a.appendChild(h)},o=(l,c)=>{const h=document.createElement("label");h.innerHTML=`${l}<input type="color">`;const f=h.querySelector("input");f.value=String(e[c]),f.oninput=()=>{e[c]=f.value,t()},a.appendChild(h)};n("kn",1e4,1e7,1e4,"kn"),n("mu",0,1,.01,"mu"),n("μ_wall",0,1,.01,"muw"),n("e",.02,.9,.01,"e"),n("g",0,2e3,10,"g"),n("damp",0,5,.05,"damp"),i("filled","filled"),o("fill","fill"),o("stroke","stroke"),n("strokeW",0,4,.1,"strokeW")}const W=document.getElementById("gl"),z=document.getElementById("overlay"),d=z.getContext("2d"),kt=new bt(W),k={kn:9e6,e:.2,mu:.4,muw:.6,g:980,gx:0,gy:980,damp:.9,dt:1/360,substeps:4,cell:32},u=new St(4e3,innerWidth*devicePixelRatio,innerHeight*devicePixelRatio,k);for(let a=0;a<200;a++)u.add(Math.random()*innerWidth*devicePixelRatio,Math.random()*innerHeight*devicePixelRatio*.5,8+6*Math.random(),6+4*Math.random());const Wt=document.getElementById("controls"),V={kn:k.kn,mu:k.mu,muw:k.muw,e:k.e,g:k.g,damp:k.damp,filled:!0,fill:"#154700",stroke:"#66FF00",strokeW:1};Et(Wt,V,()=>{k.kn=V.kn,k.mu=V.mu,k.muw=V.muw,k.e=V.e,k.g=V.g,k.damp=V.damp});document.getElementById("btn-reset-particles").onclick=()=>{u.n=0};document.getElementById("btn-reset-walls").onclick=()=>{u.clearWalls()};for(const a of Array.from(document.querySelectorAll(".spawn")))a.onclick=()=>{const e=parseInt(a.dataset.n||"10",10);for(let t=0;t<e;t++)u.add(Math.random()*W.width,20,10+8*Math.random(),8+6*Math.random())};let F="gen";for(const a of Array.from(document.querySelectorAll("#toolbar .btn")))a.onclick=()=>{F=a.dataset.tool||"gen"};function It(){const a=devicePixelRatio||1;z.width=Math.floor(innerWidth*a),z.height=Math.floor(innerHeight*a),z.style.width=innerWidth+"px",z.style.height=innerHeight+"px"}function Bt(){const a=devicePixelRatio||1;d.clearRect(0,0,z.width,z.height),d.save(),d.lineWidth=Math.max(1,Math.floor(2*a)),d.strokeStyle="#88a";for(let e=0;e<u.nWalls;e++)d.beginPath(),d.moveTo(u.wx0[e],u.wy0[e]),d.lineTo(u.wx1[e],u.wy1[e]),d.stroke();if(d.restore(),p.active){if(F==="hand")d.save(),d.strokeStyle="#ffd166",d.lineWidth=Math.max(1,Math.floor(2*a)),d.beginPath(),d.arc(p.x,p.y,14*a,0,Math.PI*2),d.stroke(),d.beginPath(),d.moveTo(p.x+10*a,p.y),d.lineTo(p.x+4*a,p.y),d.stroke(),d.restore();else if(F==="shovel"){d.save();const e=vt*a;d.strokeStyle="#69f",d.lineWidth=Math.max(1,Math.floor(2*a)),d.beginPath(),d.arc(p.x,p.y,e,0,Math.PI*2),d.stroke(),d.beginPath(),d.moveTo(p.x,p.y-e),d.lineTo(p.x,p.y-e-18*a),d.stroke(),d.restore()}else if(F.startsWith("pen")){if(d.save(),d.strokeStyle="#8cf",d.lineWidth=Math.max(1,Math.floor(2*a)),v){if(F==="pen-line")d.beginPath(),d.moveTo(v[0],v[1]),d.lineTo(p.x,p.y),d.stroke();else if(F==="pen-rect"){const e=Math.min(v[0],p.x),t=Math.min(v[1],p.y),n=Math.abs(p.x-v[0]),i=Math.abs(p.y-v[1]);d.strokeRect(e,t,n,i)}else if(F==="pen-circle"){const e=Math.hypot(p.x-v[0],p.y-v[1]);d.beginPath(),d.arc(v[0],v[1],e,0,Math.PI*2),d.stroke()}else if(F==="pen-tri"){const e=xt(v[0],v[1],p.x,p.y);d.beginPath(),d.moveTo(e[0].x,e[0].y),d.lineTo(e[1].x,e[1].y),d.lineTo(e[2].x,e[2].y),d.closePath(),d.stroke()}}else d.beginPath(),d.moveTo(p.x-8*a,p.y),d.lineTo(p.x+8*a,p.y),d.stroke(),d.beginPath(),d.moveTo(p.x,p.y-8*a),d.lineTo(p.x,p.y+8*a),d.stroke();d.restore()}}}function Tt(a,e,t,n){const i=Math.min(a,t),o=Math.max(a,t),l=Math.min(e,n),c=Math.max(e,n);u.addWall(i,l,o,l),u.addWall(o,l,o,c),u.addWall(o,c,i,c),u.addWall(i,c,i,l)}function _t(a,e,t,n){const i=Math.hypot(t-a,n-e),o=48;let l=a+i,c=e;for(let h=1;h<=o;h++){const f=2*Math.PI*h/o,s=a+i*Math.cos(f),x=e+i*Math.sin(f);u.addWall(l,c,s,x),l=s,c=x}}function xt(a,e,t,n){const i=t-a,o=n-e,c=Math.hypot(i,o)||1,h=Math.atan2(o,i),f={x:a,y:e},s={x:a+c*Math.cos(h+2*Math.PI/3),y:e+c*Math.sin(h+2*Math.PI/3)},x={x:a+c*Math.cos(h+4*Math.PI/3),y:e+c*Math.sin(h+4*Math.PI/3)};return[f,s,x]}function Lt(a,e,t,n){const i=xt(a,e,t,n);u.addWall(i[0].x,i[0].y,i[1].x,i[1].y),u.addWall(i[1].x,i[1].y,i[2].x,i[2].y),u.addWall(i[2].x,i[2].y,i[0].x,i[0].y)}function mt(){const a=devicePixelRatio||1;W.width=Math.floor(innerWidth*a),W.height=Math.floor(innerHeight*a),W.style.width=innerWidth+"px",W.style.height=innerHeight+"px",u.resize(W.width,W.height),It()}addEventListener("resize",mt);mt();function Ut(a,e){const n=8*(devicePixelRatio||1),i=n*n;let o=-1,l=i;for(let c=0;c<u.nWalls;c++){const h=u.wx0[c],f=u.wy0[c],s=u.wx1[c],x=u.wy1[c],R=s-h,b=x-f,g=a-h,A=e-f,D=R*R+b*b;let B=0;D>0&&(B=(g*R+A*b)/D,B=Math.max(0,Math.min(1,B)));const T=h+B*R,_=f+B*b,m=a-T,S=e-_,r=m*m+S*S;r<l&&(l=r,o=c)}return o}const p={active:!1,x:0,y:0};let ct=!1,at=0,lt=0,I=-1,v=null,vt=40;W.addEventListener("pointerdown",a=>{W.setPointerCapture(a.pointerId);const e=devicePixelRatio||1,t=a.clientX*e,n=a.clientY*e;if(p.active=!0,p.x=t,p.y=n,ct=!0,at=t,lt=n,F==="gen")u.add(t,n,10+8*Math.random(),8+6*(.3+.7*Math.random())),I=u.n-1;else if(F==="hand"){let i=-1,o=1e12;for(let l=0;l<u.n;l++){const c=u.x[l]-t,h=u.y[l]-n,f=c*c+h*h;f<o&&(i=l,o=f)}i>=0&&(I=i)}else if(F.startsWith("pen"))v=[t,n];else if(F==="del-wall"){const i=Ut(t,n);i>=0&&u.removeWallAt(i),ct=!1}});W.addEventListener("pointermove",a=>{const e=devicePixelRatio||1,t=a.clientX*e,n=a.clientY*e;if(p.x=t,p.y=n,!!ct){if(F==="gen")I>=0&&(u.vx[I]+=(t-at)*5,u.vy[I]+=(n-lt)*5);else if(F==="hand")I>=0&&(u.x[I]=t,u.y[I]=n,u.vx[I]=(t-at)*10,u.vy[I]=(n-lt)*10);else if(F==="shovel"){const i=vt*e,o=200;for(let l=0;l<u.n;l++){const c=u.x[l]-t,h=u.y[l]-n,f=Math.hypot(c,h);if(f<i&&f>1){const s=c/f,x=h/f;u.vx[l]+=s*o,u.vy[l]+=x*o}}}at=t,lt=n}});W.addEventListener("pointerup",a=>{const e=devicePixelRatio||1,t=a.clientX*e,n=a.clientY*e;F==="pen-line"&&v&&u.addWall(v[0],v[1],t,n),F==="pen-rect"&&v&&Tt(v[0],v[1],t,n),F==="pen-circle"&&v&&_t(v[0],v[1],t,n),F==="pen-tri"&&v&&Lt(v[0],v[1],t,n),ct=!1,I=-1,v=null,p.active=!1});function gt(){u.step(),kt.draw(innerWidth,innerHeight,u.x,u.y,u.a,u.b,u.th,u.n,V),Bt(),requestAnimationFrame(gt)}requestAnimationFrame(gt);
